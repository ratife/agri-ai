<div class="max-w-6xl mx-auto">
  <h1 class="text-3xl font-bold text-gray-800 mb-2">üîç Analyse de plantes</h1>
  <p class="text-gray-600 mb-8">
    T√©l√©chargez une photo de votre plante malade et obtenez un diagnostic instantan√© avec des recommandations de traitement.
  </p>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Formulaire d'analyse -->
    <mat-card class="p-6 shadow-lg">
      <mat-card-header>
        <mat-card-title class="text-xl font-semibold">Param√®tres d'analyse</mat-card-title>
        <mat-card-subtitle>Renseignez les informations n√©cessaires</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="mt-6 space-y-6">
        <!-- S√©lection de la plante -->
        <div>
          <mat-form-field class="w-full">
            <mat-label>Nom de la plante</mat-label>
            <input
              matInput
              [(ngModel)]="plantName"
              placeholder="Ex: Tomate, Pomme de terre..."
              [matAutocomplete]="auto"
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let plant of plantSuggestions" [value]="plant">
                {{ plant }}
              </mat-option>
            </mat-autocomplete>
            <mat-icon matSuffix>spa</mat-icon>
            <mat-hint>S√©lectionnez ou saisissez le nom de votre plante</mat-hint>
          </mat-form-field>
        </div>

        <!-- Upload d'image -->
        <div>
          <p class="text-sm font-medium text-gray-700 mb-2">Image de la plante</p>
          
          <div *ngIf="!imagePreview" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary-500 transition cursor-pointer"
               (click)="fileInput.click()">
            <mat-icon class="text-4xl text-gray-400 mb-2">cloud_upload</mat-icon>
            <p class="text-gray-600">Cliquez pour t√©l√©charger une image</p>
            <p class="text-sm text-gray-500 mt-1">Formats support√©s: JPG, PNG, WEBP (max 5MB)</p>
            <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden">
          </div>

          <!-- Aper√ßu de l'image -->
          <div *ngIf="imagePreview" class="mt-4">
            <p class="text-sm font-medium text-gray-700 mb-2">Aper√ßu</p>
            <div class="relative">
              <img [src]="imagePreview" alt="Aper√ßu" class="w-full h-64 object-cover rounded-lg shadow">
              <button mat-icon-button class="absolute top-2 right-2 bg-red-500 text-white" (click)="removeImage()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <p class="text-sm text-gray-500 mt-2">Image s√©lectionn√©e: {{ selectedFile?.name }}</p>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4 pt-4">
          <button mat-raised-button color="primary" (click)="analyze()" [disabled]="isLoading" class="flex-1">
            <mat-icon *ngIf="!isLoading">search</mat-icon>
            <mat-spinner diameter="20" *ngIf="isLoading" class="mr-2"></mat-spinner>
            {{ isLoading ? 'Analyse en cours...' : 'Lancer l\'analyse' }}
          </button>
          
          <button mat-stroked-button color="warn" (click)="reset()" [disabled]="isLoading" class="flex-1">
            <mat-icon>refresh</mat-icon>
            R√©initialiser
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- R√©sultats d'analyse -->
    <div>
      <mat-card class="p-6 shadow-lg h-full" [class.bg-gray-50]="!result">
        <mat-card-header>
          <mat-card-title class="text-xl font-semibold">R√©sultats de l'analyse</mat-card-title>
          <mat-card-subtitle>Diagnostic et recommandations</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content class="mt-6">
          <!-- √âtat vide -->
          <div *ngIf="!result && !isLoading" class="text-center py-12">
            <mat-icon class="text-6xl text-gray-300 mb-4">analytics</mat-icon>
            <p class="text-gray-500">Les r√©sultats de l'analyse appara√Ætront ici</p>
            <p class="text-sm text-gray-400 mt-2">Lancez une analyse pour obtenir un diagnostic</p>
          </div>

          <!-- Chargement -->
          <div *ngIf="isLoading" class="text-center py-12">
            <mat-spinner diameter="40" class="mx-auto mb-4"></mat-spinner>
            <p class="text-gray-600">Analyse de l'image en cours...</p>
            <p class="text-sm text-gray-500">Cela peut prendre quelques secondes</p>
          </div>

          <!-- R√©sultats -->
          <div *ngIf="result && !isLoading" class="space-y-6">
            <!-- Maladie d√©tect√©e -->
            <div class="bg-white p-6 rounded-lg shadow border-l-4 border-red-500">
              <div class="flex items-center gap-3 mb-3">
                <mat-icon class="text-red-500">warning</mat-icon>
                <h3 class="text-lg font-semibold">Maladie d√©tect√©e</h3>
              </div>
              <p class="text-2xl font-bold text-gray-800">{{ result.disease }}</p>
              <div class="flex items-center gap-2 mt-2">
                <mat-icon class="text-yellow-500">info</mat-icon>
                <span class="text-gray-600">Confiance: {{ result.confidence * 100 | number:'1.0-1' }}%</span>
              </div>
            </div>

            <!-- Recommandations -->
            <div class="bg-white p-6 rounded-lg shadow border-l-4 border-green-500">
              <div class="flex items-center gap-3 mb-3">
                <mat-icon class="text-green-500">lightbulb</mat-icon>
                <h3 class="text-lg font-semibold">Recommandations</h3>
              </div>
              <p class="text-gray-700">{{ result.advice }}</p>
            </div>

            <!-- Actions sugg√©r√©es -->
            <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
              <div class="flex items-center gap-3 mb-3">
                <mat-icon class="text-blue-500">construction</mat-icon>
                <h3 class="text-lg font-semibold">Actions √† prendre</h3>
              </div>
              <ul class="space-y-2 text-gray-700">
                <li class="flex items-center gap-2">
                  <mat-icon class="text-sm">check_circle</mat-icon>
                  <span>Isoler la plante affect√©e pour √©viter la propagation</span>
                </li>
                <li class="flex items-center gap-2">
                  <mat-icon class="text-sm">check_circle</mat-icon>
                  <span>Appliquer un traitement appropri√© dans les 48 heures</span>
                </li>
                <li class="flex items-center gap-2">
                  <mat-icon class="text-sm">check_circle</mat-icon>
                  <span>Surveiller l'√©volution pendant la semaine suivante</span>
                </li>
                <li class="flex items-center gap-2">
                  <mat-icon class="text-sm">check_circle</mat-icon>
                  <span>Consulter un expert si la situation ne s'am√©liore pas</span>
                </li>
              </ul>
            </div>

            <!-- Boutons de partage -->
            <div class="flex gap-3 pt-4">
              <button mat-stroked-button color="primary" class="flex-1">
                <mat-icon>save</mat-icon>
                Sauvegarder le rapport
              </button>
              <button mat-stroked-button color="accent" class="flex-1">
                <mat-icon>share</mat-icon>
                Partager
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Informations suppl√©mentaires -->
  <div class="mt-12">
    <mat-card class="p-6 shadow">
      <mat-card-header>
        <mat-card-title class="text-lg font-semibold">üí° Conseils pour une meilleure analyse</mat-card-title>
      </mat-card-header>
      <mat-card-content class="mt-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="flex items-start gap-3">
            <mat-icon class="text-primary-500">photo_camera</mat-icon>
            <div>
              <h4 class="font-medium">Qualit√© de l'image</h4>
              <p class="text-sm text-gray-600">Utilisez une photo nette et bien √©clair√©e de la partie affect√©e.</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <mat-icon class="text-primary-500">nature</mat-icon>
            <div>
              <h4 class="font-medium">Identification pr√©cise</h4>
              <p class="text-sm text-gray-600">Indiquez le nom exact de la plante pour un diagnostic plus fiable.</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <mat-icon class="text-primary-500">schedule</mat-icon>
            <div>
              <h4 class="font-medium">Rapidit√© d'intervention</h4>
              <p class="text-sm text-gray-600">Analysez rapidement les premiers signes de maladie.</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
